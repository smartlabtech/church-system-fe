# Backend Environment Variable Update

## New Frontend Environment Variables Added

The frontend now supports configurable church names in Arabic and English. These need to be served by the backend's `FrontendConfigController`.

## Variables Added to Frontend

```bash
VITE_CHURCH_NAME_AR=كنيسة القديس مارمرقس
VITE_CHURCH_NAME_EN=Saint Mark Church - Maadi
```

## Required Backend Changes

### 1. Update `FrontendConfigController` (backend/src/frontend-config/frontend-config.controller.ts)

**Current code:**
```typescript
@Get('env-config.js')
getEnvConfig(@Res() res: Response) {
  const apiBaseUrl = process.env.VITE_API_BASE_URL || process.env.FRONTEND_API_BASE_URL || '/api/ar';
  const churchId = process.env.VITE_API_CHURCH_ID || process.env.FRONTEND_CHURCH_ID || '63cd11f4808cc1923ca5f3ca';

  const configScript = `window._env_ = {
    VITE_API_BASE_URL: '${apiBaseUrl}',
    VITE_API_CHURCH_ID: '${churchId}'
  };`;

  res.send(configScript);
}
```

**Updated code needed:**
```typescript
@Get('env-config.js')
getEnvConfig(@Res() res: Response) {
  // API Configuration
  const apiBaseUrl = process.env.VITE_API_BASE_URL || process.env.FRONTEND_API_BASE_URL || '/api/ar';
  const churchId = process.env.VITE_API_CHURCH_ID || process.env.FRONTEND_CHURCH_ID || '63cd11f4808cc1923ca5f3ca';

  // Church Names
  const churchNameAr = process.env.VITE_CHURCH_NAME_AR || process.env.FRONTEND_CHURCH_NAME_AR || 'كنيسة القديس مارمرقس';
  const churchNameEn = process.env.VITE_CHURCH_NAME_EN || process.env.FRONTEND_CHURCH_NAME_EN || 'Saint Mark Church - Maadi';

  console.log('[FrontendConfigController] Environment variables:');
  console.log('  - API Base URL:', apiBaseUrl);
  console.log('  - Church ID:', churchId);
  console.log('  - Church Name (AR):', churchNameAr);
  console.log('  - Church Name (EN):', churchNameEn);

  const configScript = `// Runtime Environment Configuration
// Generated by backend at ${new Date().toISOString()}

window._env_ = {
  VITE_API_BASE_URL: '${apiBaseUrl}',
  VITE_API_CHURCH_ID: '${churchId}',
  VITE_CHURCH_NAME_AR: '${churchNameAr}',
  VITE_CHURCH_NAME_EN: '${churchNameEn}'
};

if (typeof console !== 'undefined') {
  console.log('[Runtime Config] Loaded from backend:', window._env_);
}
`;

  res.setHeader('Content-Type', 'application/javascript; charset=utf-8');
  res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
  res.send(configScript);
}
```

### 2. Update Docker Environment Variables

**In your deployment `.env` file (or Docker Compose environment section):**

```bash
# Frontend Configuration
FRONTEND_API_BASE_URL=/api/ar
FRONTEND_CHURCH_ID=63cd11f4808cc1923ca5f3ca
FRONTEND_CHURCH_NAME_AR=كنيسة القديس مارمرقس
FRONTEND_CHURCH_NAME_EN=Saint Mark Church - Maadi
```

**Or using VITE_ prefix (both are supported):**

```bash
VITE_API_BASE_URL=/api/ar
VITE_API_CHURCH_ID=63cd11f4808cc1923ca5f3ca
VITE_CHURCH_NAME_AR=كنيسة القديس مارمرقس
VITE_CHURCH_NAME_EN=Saint Mark Church - Maadi
```

### 3. Docker Compose Example

```yaml
services:
  backend:
    image: ghcr.io/smartlabtech/church-system-be:latest
    environment:
      # ... other env vars ...

      # Frontend Runtime Configuration
      FRONTEND_API_BASE_URL: "/api/ar"
      FRONTEND_CHURCH_ID: "63cd11f4808cc1923ca5f3ca"
      FRONTEND_CHURCH_NAME_AR: "كنيسة القديس مارمرقس"
      FRONTEND_CHURCH_NAME_EN: "Saint Mark Church - Maadi"
```

## How It Works

### Frontend Flow:

1. **Browser loads `index.html`**
2. **Loads `/env-config.js` from backend** (served by FrontendConfigController)
3. **Sets `window._env_` with runtime values**
4. **Frontend uses `ENV` utility** which checks:
   - First: `window._env_.VITE_CHURCH_NAME_AR` (from backend)
   - Then: `import.meta.env.VITE_CHURCH_NAME_AR` (from .env build)
   - Finally: Default value

### Benefits:

✅ **No frontend rebuild needed** when changing church name
✅ **Multi-tenant support** - Different names per deployment
✅ **Language-aware** - Shows correct name based on selected language
✅ **Fallback values** - Works even if env vars not set

## Testing

After updating the backend, you can test by:

1. **Check browser console:**
   ```javascript
   console.log(window._env_)
   // Should show: { VITE_CHURCH_NAME_AR: "...", VITE_CHURCH_NAME_EN: "..." }
   ```

2. **Check network tab:**
   - Open DevTools → Network
   - Find `env-config.js` request
   - Response should contain church name variables

3. **Check header logo:**
   - Should display church name from environment
   - Should change when switching language

## Deployment Checklist

- [ ] Update `FrontendConfigController` in backend repo
- [ ] Add `FRONTEND_CHURCH_NAME_AR` to deployment `.env` file
- [ ] Add `FRONTEND_CHURCH_NAME_EN` to deployment `.env` file
- [ ] Rebuild backend Docker image
- [ ] Restart backend container
- [ ] Verify `/env-config.js` serves new variables
- [ ] Test in browser (Arabic and English modes)
